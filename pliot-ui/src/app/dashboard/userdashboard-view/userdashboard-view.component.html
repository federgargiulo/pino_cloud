<h2 class="page-title">Create Dashboard</h2>

<div class="dashboard-form-container">
  <form [formGroup]="dashBoardForm" (ngSubmit)="onSubmit()" class="d-flex flex-column gap-4">

    <input type="hidden" formControlName="id">
    <input type="hidden" formControlName="configuration">

    <mat-form-field appearance="fill">
      <mat-label>Title</mat-label>
      <input matInput formControlName="title">
      <mat-error *ngIf="dashBoardForm.controls['title'].invalid && dashBoardForm.controls['title'].touched">
        Title is mandatory.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="descr" rows="4"></textarea>
      <mat-error *ngIf="dashBoardForm.controls['descr'].invalid && dashBoardForm.controls['descr'].touched">
        Description is mandatory.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Dashboard Shared</mat-label>
      <mat-select formControlName="shared">
        <mat-option [value]="'false'">NO</mat-option>
        <mat-option [value]="'true'">YES</mat-option>
      </mat-select>
    </mat-form-field>

    <div *ngIf="isPersisted">
      <app-dashconf-manager
        [initialSignals]="dashBoardForm.controls['configuration'].value"
        (jsonChanged)="updateJson($event)">
      </app-dashconf-manager>
    </div>

    <div class="d-flex justify-content-end gap-2 mt-4">
      <button mat-button (click)="onCancel()">Abort</button>
      <button mat-flat-button color="primary" [disabled]="dashBoardForm.invalid">Save</button>
      <button *ngIf="isPersisted" mat-button color="accent"
              [routerLink]="['/dash-measure', dashBoardForm.controls['id'].value]">
        View
      </button>
    </div>

    <p *ngIf="successMessage">{{ successMessage }}</p>
  </form>
</div>
